## Copyright (c) 2006, Rajendra Kadam
## All rights reserved.
##
## Redistribution and use in source and binary forms, with or without
## modification, are permitted provided that the following conditions are
## met:
##
## Redistributions of source code must retain the above copyright notice,
## this list of conditions and the following disclaimer.  Redistributions
## in binary form must reproduce the above copyright notice, this list of
## conditions and the following disclaimer in the documentation and/or
## other materials provided with the distribution.  Neither the name of
## Cenqua Pty Ltd nor the names of its contributors may be used to
## endorse or promote products derived from this software without
## specific prior written permission.
##
## THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
## "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
## LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
## A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
## OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
## SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
## LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
## DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
## THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
## (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
## OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

<!-- start display -->
<html>
    <head>
        <title>$action.getActionName($action.getClass().getName())</title>
    </head>

    #applyDecorator("root")
        #decoratorParam("helper" $action.helper)
        #decoratorParam("context" "space-custom-usermanagement") ##note this should be same as item.key defined in atlassian-plugin.xml
        #decoratorParam("mode" "view-edit-spaceusergroups")
        
            <content tag="spacekey">${action.space.key}</content>
    #set( $contextPath = "/customspacemgmt/permissions/custompermissionsmanage.action?key=$generalUtil.doubleUrlEncode($key)&" )

    <body>

    <style>
        div#csum {width:750px; margin:0 10px;}
        div#csum h2 {background:none; font-size: 1.1em; font-weight: bold; color:#036; border-bottom:1px solid #036;}
        div#csum a img {border:none;}

        div#csum div.messages {}
        div#csum div.messages ul {margin:0; padding:0; list-style:none;}
        div#csum div.messages ul li {padding:.5em; border:1px solid #3C78B5; background-color: #D8E4F1;}

        div#csum form {clear:both; margin:1em .1em; padding:0; background-color:#F0F0F0; border:1px solid #CCC;}
        div#csum fieldset {border:none; padding:none; margin:none;}
        div#csum legend {padding:10px 0 5px 0; margin:0; display:block; font-weight: bold; color: #036; font-size: 1.1em;}
        div#csum input {width:100%;}
        div#csum label {font-size:1em;}
        div#csum .submitBttn {width:auto;}
        div#csum ul.formHelp {display:block; clear:both; list-style: none; font-size:.9em; padding:1px 2px; margin: 2px 2px 10px 2px;}
        div#csum ul.formHelp li {display:block; color:#444;}

        div#csum div#header {margin:0 0 20px 0;}

        div#csum div#groups {display:block; float:left; margin:0; padding:0; width:250px;}
        div#csum div#groups ul {margin:0; padding:0;}
        div#csum div#groups ul li {list-style:none;}
        div#csum div#groups ul li a {display:block; background:url(${action.confluenceRoot}/images/icons/group_16.gif) no-repeat 3px 3px; clear:both; line-height:1.5; padding:4px 0 4px 25px; color:#036; text-decoration:underline;}
        div#csum div#groups ul li a.selected {color:black; font-weight:bold; text-decoration:none; border:1px solid #CCC; background-color:#FFC;}
        div#csum div#groups ul li a.selected:hover {background-color: #FFC;}
        div#csum div#groups ul li a:hover {background-color:#F0F0F0;}
        div#csum div#groups ul li a:active {background-color:#DDD;}
        div#csum div#groups form {}

        div.mode {float:right; padding:3px 3px 0 0;}
        div.mode a {text-decoration:none;}
        div.mode a img {height:11px;}
        div.mode a:hover {color:#333;}
        div.mode a.selected {font-weight:bold;}

        div#csum div#groupEditor {float:right; width:476px; padding:0 10px;}

        div#csum div.groupOpts {text-align:right;}
        div#csum div.groupOpts a {text-decoration:none;}
        div#csum div.groupOpts a img {height:12px;}

        div#csum table {width:100%; border-bottom:2px solid #036;}
        div#csum table tr {}
        div#csum table tr.even {background-color:#EEE;}
        div#csum table tr th {font-weight:bold; color:#036; text-align:left; border-bottom:2px solid #036;}
        div#csum table tr td {padding:1px 2px;}
        div#csum table tr td.delete {width:4em; text-align:center;}

        div#csum div#bulkEdit {}
        div#csum form#bulkChange fieldset label {display: block; margin: 1em 0 0 0;}
        div#csum form#bulkChange fieldset input {width:auto;}

        div#csum div#footer {clear:both; border-top:1px solid #CCC;}
        div#csum div#footer ul {clear:both; display:block; margin:0; padding:0;}
        div#csum div#footer ul li {display:inline;}
        div#csum div#footer ul li a {display:block; color:#036; margin:0; padding:5px 10px; float:left; line-height:1; border-right:1px solid #CCC;}
        div#csum div#footer ul li a img {padding:0 5px;}

        div#csum a#showAdvS {margin:6px 0 0 0; display: block; float:right; clear: both; text-decoration:none;}
        div#csum a#hideAdvS {display:block; margin:3px 3px 1px 0; float:right; text-decoration: none;}

        div#csum div#addUserOpts {background-color: #FFF; border:1px solid #CCC; padding:0;}
        div#csum div#addUserOpts ul {list-style: none; margin:0; padding:0;}
        div#csum div#addUserOpts ul li {display:block; margin:0; padding:.2em .4em;}
        div#csum div#addUserOpts ul li.myCustomHighlightClass {margin:0; padding:.2em .4em; background:#FFFFCC; font-weight: bold;}
        div#csum div#addUserOpts ul li.myCustomPrehighlightClass {margin:0; padding:.2em .4em; background:#D8E4F1;}
		
		div#csum div.paging {border-top:1px solid #DDD; color:#666;}
		div#csum div.paging span.prev  {display:block; float:left;}
		div#csum div.paging span.next  {display:block; float:right;}
		div#csum div.paging span.count {display:block; text-align:center}
    </style>

<div id="csum">
    <div class="messages">
		#parse ( "/templates/permissionmgmt/action-messages.vm" )
	</div>

    #set($configValidationResponse=$action.configValidationResponse)
	#if($configValidationResponse.isValid())

    #if(${action.selectedGroup})
        <a href="docustompermissionsmanage.action?key=$generalUtil.doubleUrlEncode($key)&selectedGroup=$generalUtil.doubleUrlEncode($action.selectedGroup)&refresh=1">Refresh</a>
    #else
        <a href="docustompermissionsmanage.action?key=$generalUtil.doubleUrlEncode($key)&refresh=1">Refresh</a>
    #end

    <div id="groups">
        #parse( "/templates/permissionmgmt/group-list.vm" )
    </div>
        
        <div id="groupEditor">
        #if($action.userSearch)
            #parse ( "/templates/permissionmgmt/manage-users-advanced.vm" )
        #elseif($action.bulkEdit)
            #parse ( "/templates/permissionmgmt/bulk-edit.vm" )
        #else
            #if(${action.selectedGroup})
                #parse ( "/templates/permissionmgmt/manage-users-basic.vm" )
            #end
        #end
        </div>
    #else
        #if(${action.customPermissionConfiguration.pluginDown} == "yes")
            <p class="infoMacro">${action.customPermissionConfiguration.downTimeMessage}</p>
		#else
		    <p class="noteMacro">
		    <p>
		    An administrator must <a href="$action.confluenceRoot/admin/plugins/custompermissionsconfig/config.action">reconfigure</a> "Custom Space Usergroups Manager" before you start using it.
		    </p>
		    <p>
		    The following need to be configured before this plugin can be used:
		    #set($fieldNameToErrorMessage=$configValidationResponse.fieldNameToErrorMessage)
		    <ul>
            #foreach($configFieldName in $fieldNameToErrorMessage.keySet())
                <li>$configFieldName: $fieldNameToErrorMessage.get($configFieldName)</li>
            #end
		    </ul>
		    </p>
		    </p>

		#end
    #end

    #parse ( "/admin/admin-breadcrumbs.vm" )

#*
    #if($isGroupActionsPermitted)
		<div id="footer">
			<ul>
				<li><a href="${action.confluenceRoot}/spaces/spacepermissions.action?key=$generalUtil.doubleUrlEncode($key)"><img src="${action.confluenceRoot}/images/icons/lock_16.gif"/>Edit ${action.selectedGroup} Permissions</a></li>
				<li><a href="${action.confluenceRoot}/pages/listpermissionpages.action?key=$generalUtil.doubleUrlEncode($key)"><img src="${action.confluenceRoot}/images/icons/locked_pages_16.gif"/>Edit Page Permissions</a></li>
			</ul>
			<div style="clear:both"></div>
		</div>
	#else
		<div style="clear:both"></div>
    #end
*#

<div style="clear:both"></div>

#end
</div>
<!-- end display -->

</body>
</html>